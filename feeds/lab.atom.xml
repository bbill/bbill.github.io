<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>SDN Hands ON!</title><link href="https://bbill.github.io/" rel="alternate"></link><link href="https://bbill.github.io/feeds/lab.atom.xml" rel="self"></link><id>https://bbill.github.io/</id><updated>2017-11-08T00:00:00+08:00</updated><entry><title>Pica8 白盒交换机快速上手</title><link href="https://bbill.github.io/pica8_quick_start.html" rel="alternate"></link><published>2017-11-08T00:00:00+08:00</published><author><name>bill</name></author><id>tag:bbill.github.io,2017-11-08:pica8_quick_start.html</id><summary type="html">&lt;div id="table-of-contents"&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#sec-1"&gt;1. 初始设置和访问&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#sec-1-1"&gt;1.1. 登陆交换机&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#sec-1-2"&gt;1.2. 设定默认启动模式&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#sec-1-3"&gt;1.3. 设置 Openflow SDN网络&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#sec-2"&gt;2. TAP简单上手&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#sec-3"&gt;3. 软件版本升级&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#sec-4"&gt;4. 手册及参考&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;


&lt;div id="outline-container-sec-1" class="outline-2"&gt;
&lt;h2 id="sec-1"&gt;&lt;span class="section-number-2"&gt;1&lt;/span&gt; 初始设置和访问&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-1"&gt;
&lt;/div&gt;&lt;div id="outline-container-sec-1-1" class="outline-3"&gt;
&lt;h3 id="sec-1-1"&gt;&lt;span class="section-number-3"&gt;1.1&lt;/span&gt; 登陆交换机&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-1-1"&gt;
&lt;p&gt;
交换机开箱后的初始登录，可以通过 串口(RJ45)来进行。 找到交换机 的console
口(一般会标有Con)。通过windows 主机上的超级终端工具，或者putty,
securecrt 等 终端工具，配置串口参数为 115200,
8/N/1,硬件流控设为没有（关闭）.后即可 登录。默认用户名 admin ，密码
&lt;b&gt;pica8&lt;/b&gt; 。
&lt;/p&gt;


&lt;div class="figure"&gt;
&lt;p&gt;&lt;img src="http://www.tooyum.com/images/rs232.png" alt="rs232.png" width="300px" /&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;pre class="example"&gt;
PicOS-OVS login: admin
Password:

admin@XorPlus$
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-sec-1-2" class="outline-3"&gt;
&lt;h3 id="sec-1-2"&gt;&lt;span class="section-number-3"&gt;1.2&lt;/span&gt; 设定默认启动模式&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-1-2"&gt;
&lt;ol class="org-ol"&gt;
&lt;li&gt;验证当前Pica8模式 [sec-4-0-0-1]

&lt;p&gt;
通过发出下面的命令检查PICOS交换机 的当前模式。
&lt;/p&gt;

&lt;pre class="example"&gt;
admin@XorPlus$ps -ef | grep xorp | grep -v grep
admin@XorPlus$ps -ef | grep ovs | grep -v grep
admin@XorPlus$
admin@XorPlus$
&lt;/pre&gt;

&lt;p&gt;
如果有xorp 进程输出表明目前处于传统模式（可通过crossflow
支持混杂），如 果有ovs 输出则为纯 SDN模式。
&lt;/p&gt;

&lt;p&gt;
默认启动模式可以通过如下命令向导进行切换，以切换到 SDN模式为例：
&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;运行Pica8模式切换程序 [sec-4-0-0-2]

&lt;p&gt;
由于我们建立Pica8交换机的SDN应用程序，我们将把交换机设为
OVS模式以支持 OpenFlow。要做到这一点，我们将运行Pica8模式切换程序。
&lt;/p&gt;

&lt;p&gt;
在命令行中输入'sudo picos&lt;sub&gt;boot'&lt;/sub&gt; ，当系统提示时输入' 2 '
选择OVS模式。
&lt;/p&gt;

&lt;pre class="example"&gt;
admin@XorPlus$sudo picos_boot
Please configure the default system start-up options:
 (Press other key if no change)
    [1]  PicOS L2/L3
    [2]  PicOS Open vSwitch/OpenFlow
    [3]  No start-up options   * default
Enter your choice (1,2,3):2
&lt;/pre&gt;

&lt;p&gt;
接下来的一系列提示将设置 eth0接口 IP地址
。OpenFlow的包和SSH通信将使用
这个IP地址。输入IP地址，子网掩码和默认网关。
&lt;/p&gt;

&lt;pre class="example"&gt;
PicOS Open vSwitch/OpenFlow is selected.

Note: Defaultly, the OVS server is runned with static local management IP and port 6640.
The default way of vswitch connecting to server is PTCP.

Please set a static IP and netmask for the switch (e.g. 128.0.0.10/24) : 192.168.16.101/24

Please set the gateway IP (e.g 172.168.1.2):192.168.16.1

admin@XorPlus$
&lt;/pre&gt;
&lt;/li&gt;

&lt;li&gt;启动PicOS 服务 [sec-4-0-0-3]

&lt;p&gt;
验证PICOS模式的改变。启动PICOS服务 'sudo service picos start'
来应用这 个改变
&lt;/p&gt;

&lt;pre class="example"&gt;
admin@XorPlus$sudo service picos start
[....] Stopping enhanced syslogd: rsyslogd.
[....] Starting enhanced syslogd: rsyslogd.
[....] Stopping internet superserver: xinetd.
[....] Restarting OpenBSD Secure Shell server: sshd.
[....] Create OVS database file.
RTNETLINK answers: No such process
[....] Starting: PicOS Open vSwitch/OpenFlow.
[....] Starting web server: lighttpd.
&lt;/pre&gt;
&lt;/li&gt;

&lt;li&gt;验证 PicOS 模式 [sec-4-0-0-4]

&lt;p&gt;
验证对 'picos\&lt;sub&gt;start&lt;/sub&gt;.conf' 文件的改变。
&lt;/p&gt;

&lt;pre class="example"&gt;
admin@XorPlus$more /etc/picos/picos_start.conf
# configuration file for PicOS

[PICOS]
picos_start=ovs

[XORPPLUS]
xorpplus_rtrmgr_verbose=
xorpplus_log_facility=local0
xorpplus_finder_client_address=127.0.0.1
xorpplis_finder_server_address=127.0.0.1

[OVS]
ovs_database_file=/ovs/ovs-vswitchd.conf.db
ovs_db_sock_file=/ovs/var/run/openvswitch/db.sock
ovs_switch_ip_address=192.168.16.101
ovs_switch_ip_netmask=255.255.255.0
ovs_switch_gateway_ip=192.168.16.1
ovs_switch_tcp_port=6633
ovs_host_name=PicOS-OVS

[ZTP]
ztp_disable=false
&lt;/pre&gt;

&lt;p&gt;
验证OVS进程正在运行:
&lt;/p&gt;

&lt;p&gt;
如果进程输出如下，则Pica8 交换机运行在 OVS/Openflow 模式下。
&lt;/p&gt;

&lt;pre class="example"&gt;
admin@XorPlus$ps -ef | grep ovs | grep -v grep
root      3182     1  0 05:26 ttyS0    00:00:00 ovsdb-server /ovs/ovs-vswitchd.conf.db --remote=ptcp:6633:192.168.16.101 --remote=punix:/ovs/var/run/openvswitch/db.sock
root      3184     1  0 05:26 ttyS0    00:00:00 ovs-vswitchd --pidfile=ovs-vswitchd.pid --overwrite-pidfile
&lt;/pre&gt;

&lt;p&gt;
现在重新启动交换机，以确保配置是持久的。这可能需要几分钟的时间才能完成。(如果确认 /etc/picos/picos&lt;sub&gt;start&lt;/sub&gt;.conf 已经成功修改，则此步骤可以省略）
&lt;/p&gt;

&lt;pre class="example"&gt;
admin@XorPlus$sudo reboot

Broadcast message from root@PicOS-OVS (ttyS0) (Tue Oct 21 05:47:19 2014):

The system is going down for reboot NOW!
&lt;/pre&gt;
&lt;/li&gt;

&lt;li&gt;验证 Pica8 网络连通性 [sec-4-0-0-5]

&lt;p&gt;
一旦重启完成后，作为管理员重新登录，检查和验证eth0接口到默认
网关的网络连接。需要注意的是主机名已经按照‘ picos\&lt;sub&gt;start&lt;/sub&gt;.conf
“文件更改。
&lt;/p&gt;

&lt;pre class="example"&gt;
admin@PicOS-OVS$ifconfig eth0
eth0      Link encap:Ethernet  HWaddr 48:6e:73:02:00:22
          inet addr:192.168.16.101  Bcast:192.168.16.255  Mask:255.255.255.0
          inet6 addr: fe80::4a6e:73ff:fe02:22/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:8 errors:0 dropped:0 overruns:0 frame:0
          TX packets:15 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:608 (608.0 B)  TX bytes:3082 (3.0 KiB)
          Base address:0x2000

admin@PicOS-OVS$
admin@PicOS-OVS$ping 192.168.16.1
PING 192.168.16.1 (192.168.16.1) 56(84) bytes of data.
64 bytes from 192.168.16.1: icmp_req=1 ttl=64 time=32.7 ms
64 bytes from 192.168.16.1: icmp_req=2 ttl=64 time=2.00 ms
64 bytes from 192.168.16.1: icmp_req=3 ttl=64 time=0.939 ms
^C
--- 192.168.16.1 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2002ms
rtt min/avg/max/mdev = 0.939/11.900/32.754/14.752 ms
&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-sec-1-3" class="outline-3"&gt;
&lt;h3 id="sec-1-3"&gt;&lt;span class="section-number-3"&gt;1.3&lt;/span&gt; 设置 Openflow SDN网络&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-1-3"&gt;
&lt;ol class="org-ol"&gt;
&lt;li&gt;创建虚拟交换机 [sec-4-0-0-6]

&lt;p&gt;
接下来的步骤将指导如何创建使用OpenFlow的一个基本的桥(虚拟交换机)。
&lt;/p&gt;
&lt;ol class="org-ol"&gt;
&lt;li&gt;license 检查

&lt;p&gt;
在开始设定之前需要确认交换机的license
是否激活，在交换机的命令行界面里执行
&lt;/p&gt;

&lt;pre class="example"&gt;
license -s
&lt;/pre&gt;

&lt;p&gt;
如果显示：
&lt;/p&gt;

&lt;pre class="example"&gt;
No license installed.Use below information to create a license
&lt;/pre&gt;

&lt;p&gt;
&amp;#x2026;
&lt;/p&gt;

&lt;p&gt;
请将输出的Hardware ID，发邮件到 service@tooyum.com,我们会帮助申
请license，并发回。 您收到 file.lic文件后将该文件复制到交换机的
/etc 目录下。或者创建一个新的文件并将file.lic 文件的内容复制到
该文件中。 然后在交换机上执行
&lt;/p&gt;

&lt;pre class="example"&gt;
sudo license -i /etc/file.lic
&lt;/pre&gt;

&lt;p&gt;
并再次执行
&lt;/p&gt;

&lt;pre class="example"&gt;
license -s
&lt;/pre&gt;

&lt;p&gt;
以确认 license 成功导入。
&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;船舰虚拟交换机

&lt;p&gt;
在成功激活所有端口后，可以使用如下 open vSwitch
命令,创建一个虚拟交换机br0。以命令行为例：
&lt;/p&gt;

&lt;pre class="example"&gt;
admin@PicOS-OVS$ovs-vsctl add-br br0 -- set bridge br0 datapath_type=pica8

device ovs-pica8 entered promiscuous mode
device br0 entered promiscuous mode
admin@PicOS-OVS$
&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;

&lt;li&gt;验证虚拟交换机 [sec-4-0-0-7]

&lt;p&gt;
下一步验证桥已成功创建。
&lt;/p&gt;

&lt;pre class="example"&gt;
admin@PicOS-OVS$ovs-ofctl show br0
OFPT_FEATURES_REPLY (OF1.4) (xid=0x2): dpid:5e3ea67edf6c5f60
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS GROUP_STATS
OFPST_PORT_DESC reply (OF1.4) (xid=0x4):
 LOCAL(br0): addr:a6:7e:df:6c:5f:60
     config:     0
     state:      LINK_UP
     current:    10MB-FD COPPER
     supported:  10MB-FD COPPER
     speed: 10 Mbps now, 10 Mbps max
OFPT_GET_CONFIG_REPLY (OF1.4) (xid=0x6): frags=normal miss_send_len=0
&lt;/pre&gt;

&lt;p&gt;
问：br0 包含物理接口吗？
&lt;/p&gt;

&lt;p&gt;
回答：不包含。虽然虚拟交换机已经创建，物理接口需要被添加到虚拟交换机。
&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;给虚拟交换机加入接口 [sec-4-0-0-8]

&lt;p&gt;
接下来，我们将添加物理接口给虚拟交换机br0。实验拓扑结构，我们将加入
GE-1/1/1 ， GE-1/1/2 ，和GE-1/1/48,请注意，务必正确输入下面命令。
&lt;/p&gt;

&lt;pre class="example"&gt;
admin@PicOS-OVS$ovs-vsctl add-port br0 ge-1/1/1 vlan_mode=trunk tag=1 -- set interface ge-1/1/1 type=pica8
admin@PicOS-OVS$ovs-vsctl add-port br0 ge-1/1/2 vlan_mode=trunk tag=1 -- set interface ge-1/1/2 type=pica8
admin@PicOS-OVS$ovs-vsctl add-port br0 ge-1/1/48 vlan_mode=trunk tag=1 -- set interface ge-1/1/48 type=pica8
admin@PicOS-OVS$
&lt;/pre&gt;

&lt;p&gt;
如果您需要连续的加入每个千兆端口则可以用一个 for 循环来简化输入,以24口千兆+4口万兆交换机为例：
&lt;/p&gt;

&lt;p&gt;
添加千兆端口
&lt;/p&gt;

&lt;pre class="example"&gt;
for i in $(seq 1 24);do ovs-vsctl add-port br0 ge-1/1/$i vlan_mode=trunk tag=1 -- set interface ge-1/1/$i type=pica8;done
&lt;/pre&gt;

&lt;p&gt;
添加万兆端口，万兆端口的编号视不同平台不同，可能是 （25~28，49~52等请根据实际情况调整）。
&lt;/p&gt;

&lt;pre class="example"&gt;
for i in $(seq 25 28);do ovs-vsctl add-port br0 te-1/1/$i vlan_mode=trunk tag=1 -- set interface te-1/1/$i type=pica8;done
&lt;/pre&gt;

&lt;p&gt;
5101 添加所有端口可以采用如下命令：
&lt;/p&gt;

&lt;pre class="example"&gt;
for i in $(seq 1 40);do ovs-vsctl add-port br0 te-1/1/$i vlan_mode=trunk tag=1 -- set interface te-1/1/$i type=pica8;done
for i in $(seq 41 48);do ovs-vsctl add-port br0 qe-1/1/$i vlan_mode=trunk tag=1 -- set interface qe-1/1/$i type=pica8;done
&lt;/pre&gt;

&lt;p&gt;
一般来说采用outband模式进行SDN网络管理无须额外设定，但是如果测试时
 为了方便将SDN交换机的数据端口和管理端口挂接在相同的二层网络里可能
 会导致交换机触发inband相关配置（因为在PicOS 2.4 以后默认的连接方式
 为 in-band），为了规避可能的问题，可以用如下命令禁用：
&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;


&lt;pre class="example"&gt;
ovs-vsctl set bridge br0 other_config=disable-in-band=true
&lt;/pre&gt;




&lt;ol class="org-ol"&gt;
&lt;li&gt;验证虚拟交换机连接 [sec-4-0-0-9]

&lt;p&gt;
我们可以使用相同的命令验证对br0的修改。
&lt;/p&gt;

&lt;pre class="example"&gt;
admin@PicOS-OVS$ovs-ofctl show br0
OFPT_FEATURES_REPLY (OF1.4) (xid=0x2): dpid:5e3e486e73020023
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS GROUP_STATS
OFPST_PORT_DESC reply (OF1.4) (xid=0x4):
 1(ge-1/1/1): addr:48:6e:73:02:00:23
     config:     0
     state:      LINK_UP
     current:    1GB-FD COPPER AUTO_NEG
     advertised: 10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
     supported:  10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
     peer:       10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER
     speed: 1000 Mbps now, 1000 Mbps max
 2(ge-1/1/2): addr:48:6e:73:02:00:23
     config:     0
     state:      LINK_UP
     current:    1GB-FD COPPER AUTO_NEG
     advertised: 10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
     supported:  10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
     peer:       10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER
     speed: 1000 Mbps now, 1000 Mbps max
 48(ge-1/1/48): addr:48:6e:73:02:00:23
     config:     0
     state:      LINK_UP
     current:    1GB-FD COPPER AUTO_NEG
     advertised: 10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
     supported:  10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
     peer:       10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER
     speed: 1000 Mbps now, 1000 Mbps max
 LOCAL(br0): addr:48:6e:73:02:00:23
     config:     0
     state:      LINK_UP
     current:    10MB-FD COPPER
     supported:  10MB-FD COPPER
     speed: 10 Mbps now, 10 Mbps max
OFPT_GET_CONFIG_REPLY (OF1.4) (xid=0x6): frags=normal miss_send_len=0
admin@PicOS-OVS$
&lt;/pre&gt;

&lt;p&gt;
问：在交换机上运行什么版本的OpenFlow？
&lt;/p&gt;

&lt;p&gt;
答：如OFPT\&lt;sub&gt;GET\&lt;/sub&gt;&lt;sub&gt;CONFIG\&lt;/sub&gt;&lt;sub&gt;REPLY&lt;/sub&gt; 所示，PicOS
2.4.1交换机默认运行OF1.4。
&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;测试主机连接 [sec-4-0-0-10]

&lt;p&gt;
vBridge添加物理端口后，我们将试图通过Pica8交换机转发一些数据包。从连接在1口上的主机ping
2口上连接的主机。
&lt;/p&gt;

&lt;pre class="example"&gt;
pica8@of-dev01-traff01:~$ ping 10.10.11.3
PING 10.10.11.3 (10.10.11.3) 56(84) bytes of data.
^C
--- 10.10.11.3 ping statistics ---
3 packets transmitted, 0 received, +1 errors, 100% packet loss, time 2000ms
&lt;/pre&gt;

&lt;p&gt;
ping失败，是因为Pica8交换机尚未连接到OpenFlow控制器。由
于Pica8遵循OpenFlow的标准，不匹配任何流规则的流量包，应首先通 过
OFPT\&lt;sub&gt;PACKET\&lt;/sub&gt;&lt;sub&gt;OUT&lt;/sub&gt; 消息重定向到控制器。
&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;验证控制器可达 [sec-4-0-0-11]

&lt;p&gt;
我们必须配置交换机连接到通过OpenFlow的控制器。
&lt;/p&gt;

&lt;pre class="example"&gt;
admin@PicOS-OVS$ping 192.168.16.82 -c 3
PING 192.168.16.82 (192.168.16.82) 56(84) bytes of data.
64 bytes from 192.168.16.82: icmp_req=1 ttl=64 time=3.28 ms
64 bytes from 192.168.16.82: icmp_req=2 ttl=64 time=0.393 ms
64 bytes from 192.168.16.82: icmp_req=3 ttl=64 time=0.458 ms

--- 192.168.16.82 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2001ms
rtt min/avg/max/mdev = 0.393/1.378/3.284/1.348 ms
&lt;/pre&gt;
&lt;/li&gt;

&lt;li&gt;配置Pica8交换机连接到Ryu Openflow 控制器。 [sec-4-0-0-12]

&lt;p&gt;
配置Pica8交换机连接到通过对应的 Ryu 控制器。
&lt;/p&gt;

&lt;pre class="example"&gt;
admin@PicOS-OVS$
admin@PicOS-OVS$ovs-vsctl set-controller br0 tcp:192.168.16.82:6633
admin@PicOS-OVS$
&lt;/pre&gt;
&lt;/li&gt;

&lt;li&gt;验证OpenFlow的连接 [sec-4-0-0-13]

&lt;p&gt;
验证Pica8 交换机 有一个到端口6633的连接 。
&lt;/p&gt;

&lt;pre class="example"&gt;
admin@PicOS-OVS$
admin@PicOS-OVS$netstat -n | grep 6633
admin@PicOS-OVS$
&lt;/pre&gt;

&lt;p&gt;
问：交换机和控制器是否打开了一个会话？
&lt;/p&gt;

&lt;p&gt;
答：不可以，要搞清楚OpenFlow的各种设备支持哪些版本。回想一下我们以前的步骤，
所述交换机默认为OF1.4
。也许我们的应用程序不支持默认版本。请注意，您还
可以看到会话状态处于TIME\&lt;sub&gt;WAIT或FIN\&lt;/sub&gt;&lt;sub&gt;WAIT2&lt;/sub&gt; 状态。
&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;设置 OpenFlow 版本 [sec-4-0-0-14]

&lt;p&gt;
我们将试图通过设置交换机的OpenFlow的版本为1.3来解决交换机和控制器之间的问题：
。在交换机上使用下面的命令进行此更改。
&lt;/p&gt;

&lt;pre class="example"&gt;
admin@PicOS-OVS$
admin@PicOS-OVS$ovs-vsctl set Bridge br0 protocols=OpenFlow13
admin@PicOS-OVS$
&lt;/pre&gt;
&lt;/li&gt;

&lt;li&gt;验证OpenFlow的连接 [sec-4-0-0-15]

&lt;p&gt;
运行'netstat -n | grep 6633'命令，看看是否已经解决了问题。
&lt;/p&gt;

&lt;pre class="example"&gt;
admin@PicOS-OVS$netstat -n | grep 6633
tcp        0      0 192.168.16.101:56974    192.168.16.82:6633      ESTABLISHED
admin@PicOS-OVS$
&lt;/pre&gt;

&lt;p&gt;
问：交换机打开了和控制器的会话吗？
&lt;/p&gt;

&lt;p&gt;
答：是的！成功，我们已经通过OpenFlow的控制器连接到Pica8交换机。
&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-sec-2" class="outline-2"&gt;
&lt;h2 id="sec-2"&gt;&lt;span class="section-number-2"&gt;2&lt;/span&gt; TAP简单上手&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-2"&gt;
&lt;p&gt;
系统启动后，将需要设定的流表命令追加到/etc/rc3.d/S06tap，如果要确认效果，可以执行
&lt;/p&gt;

&lt;pre class="example"&gt;
source /etc/rc3.d/S06tap
&lt;/pre&gt;

&lt;p&gt;
用类似如下命令查看生效的流表：
&lt;/p&gt;

&lt;pre class="example"&gt;
ovs-ofctl dump-flows br0
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-sec-3" class="outline-2"&gt;
&lt;h2 id="sec-3"&gt;&lt;span class="section-number-2"&gt;3&lt;/span&gt; 软件版本升级&lt;/h2&gt;
&lt;/div&gt;

&lt;div id="outline-container-sec-4" class="outline-2"&gt;
&lt;h2 id="sec-4"&gt;&lt;span class="section-number-2"&gt;4&lt;/span&gt; 手册及参考&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-4"&gt;
&lt;p&gt;
由于产品版本更新较快，随机并没有附操作手册。
&lt;/p&gt;

&lt;p&gt;
Pica8 交换机的配置文档主要有:
&lt;/p&gt;

&lt;p&gt;
在OVS模式下的纯OpenFlow配置手册及传统交换机（二、三层）配置手册请访问
&lt;a href="https://pan.baidu.com/s/1c2zpZeK"&gt;https://pan.baidu.com/s/1c2zpZeK&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
如果要查找最新的文档请参考
&lt;a href="http://www.pica8.com/support/documentation/"&gt;Pica8 文档&lt;/a&gt;.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</summary><category term="pica"></category><category term="white box"></category><category term="openflow"></category><category term="sdn"></category></entry><entry><title>在P-3290 系统上安装 PicOS 操作系统</title><link href="https://bbill.github.io/lab/upgrade_P-3290.html" rel="alternate"></link><published>2017-10-16T00:00:00+08:00</published><author><name>bill</name></author><id>tag:bbill.github.io,2017-10-16:lab/upgrade_P-3290.html</id><summary type="html">&lt;div id="table-of-contents"&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#sec-1"&gt;1. 重启交换机&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-sec-1" class="outline-2"&gt;
&lt;h2 id="sec-1"&gt;&lt;span class="section-number-2"&gt;1&lt;/span&gt; 重启交换机&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-1"&gt;
&lt;p&gt;
以3290 为例，不同交换机进入 底层 shell的方法不同
&lt;/p&gt;

&lt;p&gt;
使用串口连接交换机，重启后在系统出现
&lt;/p&gt;

&lt;p&gt;
press any key to stop autoboot 时，按回车
&lt;/p&gt;

&lt;p&gt;
会进入一个shell
&lt;/p&gt;

&lt;p&gt;
执行run flash&lt;sub&gt;bootcmd&lt;/sub&gt;
&lt;/p&gt;

&lt;p&gt;
等待运行结束，出现菜单选项时，敲两次 &lt;b&gt;ctrl +d&lt;/b&gt;, 进入shell
&lt;/p&gt;


&lt;div class="org-src-container"&gt;

&lt;pre class="src src-bash"&gt;cd /cf_card
rm –rf [a-y]* 
tftp -gr picos-2.9.2.5-P3290-30f7332.tar.gz -l z.tgz 192.168.10.250
tar xzvf z.tgz
sync
reboot
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
重启交换机确认，系统已经更新至最新版本。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</summary><category term="P-3290"></category><category term="upgrade"></category><category term="pica8"></category><category term="sdn"></category><category term="openflow"></category><category term="baremetal"></category></entry><entry><title>升级Pica8操作系统</title><link href="https://bbill.github.io/lab/upgrade_picos.html" rel="alternate"></link><published>2017-10-16T00:00:00+08:00</published><author><name>bill</name></author><id>tag:bbill.github.io,2017-10-16:lab/upgrade_picos.html</id><summary type="html">&lt;p&gt;
更新前需要做如下检查，确保能使用upgrade命令升级：
&lt;/p&gt;


&lt;ol class="org-ol"&gt;
&lt;li&gt;确定备份分区状态（它必须是ok或者up-to-date）

&lt;blockquote&gt;
&lt;p&gt;
admin@PicOS-OVS$cat /etc/picos/fs&lt;sub&gt;status&lt;/sub&gt;
&lt;/p&gt;

&lt;p&gt;
primary: ok
&lt;/p&gt;

&lt;p&gt;
secondary: up-to-date
&lt;/p&gt;

&lt;p&gt;
admin@PicOS-OVS$
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;

&lt;li&gt;上传更新image文件到交换机的/cftmp 目录

&lt;p&gt;
假设您用来下载的主机系统为linux，IP地址为 10.10.10.16，下载的文
件名为 picos-2.8.0-P5401-45ec985.tar.gz 在确保交换机可以ping 通
10.10.50.16后，可以在 &lt;b&gt;交换机&lt;/b&gt; 上执行
&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;
admin@PicOS-OVS$cd &lt;i&gt;cftmp&lt;/i&gt;
&lt;/p&gt;

&lt;p&gt;
admin@PicOS-OVS$sudo scp user@10.10.50.16:/home/user/picos-2.8.0-P5401-45ec985.tar.gz ./
&lt;/p&gt;

&lt;p&gt;
admin@PicOS-OVS$sudo scp user@10.10.50.16:/home/user/picos-2.8.0-P5401-45ec985.tar.gz.md5 ./
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;
此步骤的目的是将升级映像复制到交换机的/cftmp 目录下。
&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;在/cftmp下执行upgrade命令升级交换机版本

&lt;blockquote&gt;
&lt;p&gt;
admin@PicOS-OVS$ cd /cftmp
admin@PicOS-OVS$ sudo upgrade picos-2.8.0-P5401-45ec985.tar.gz  
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
&lt;p&gt;
./etc/lsb-release
&lt;/p&gt;

&lt;p&gt;
Upgrading P5401
&lt;/p&gt;

&lt;p&gt;
Upgrade P5401 started
&lt;/p&gt;

&lt;p&gt;
Checking MD5 of image
&lt;/p&gt;

&lt;p&gt;
MD5 Check OK!
&lt;/p&gt;

&lt;p&gt;
./etc/p1upgrade.sh
&lt;/p&gt;

&lt;p&gt;
Back up PicOS configuration files
&lt;/p&gt;

&lt;p&gt;
/ovs/ovs-vswitchd.conf.db /etc/picos/picos&lt;sub&gt;start&lt;/sub&gt;.conf
&lt;/p&gt;

&lt;p&gt;
Config files saved locally as
&lt;/p&gt;

&lt;p&gt;
/cftmp/CONFIG&lt;sub&gt;FILE&lt;/sub&gt;&lt;sub&gt;P5401&lt;/sub&gt;-10.10.51.162-@20170116.tgz
&lt;/p&gt;

&lt;p&gt;
Backup PicOS license files
&lt;/p&gt;

&lt;p&gt;
/etc/picos/switch-public.key /etc/picos/pica.lic
&lt;/p&gt;

&lt;p&gt;
License files saved locally as
&lt;/p&gt;

&lt;p&gt;
/cftmp/LICENSE&lt;sub&gt;FILE&lt;/sub&gt;&lt;sub&gt;P5401&lt;/sub&gt;-10.10.51.162-@20170116.tgz
&lt;/p&gt;

&lt;p&gt;
Rebooting in 10 seconds!
&lt;/p&gt;

&lt;p&gt;
admin@PicOS-OVS$
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
</summary><category term="pica8"></category><category term="maitainence"></category><category term="openflow"></category><category term="hardware"></category><category term="upgrade"></category></entry></feed>